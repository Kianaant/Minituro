<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tick Tock Wizard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:'Poppins',sans-serif;}

body{
  margin:0;
  background:#f4efe6;
  display:flex;
  justify-content:center;
}

.mobile-wrapper{
  width:100%;
  max-width:420px;
  height:100vh;
  display:flex;
  flex-direction:column;
  position:relative;
  background:#f4efe6;
}

.content{
  flex:1;
  overflow-y:auto;
  padding:20px;
  text-align:center;
  padding-bottom:100px;
}

.logo{width:90px;margin:0 auto 5px;display:block;}
.character{width:200px;margin-bottom:10px;}

.question{
  background:white;
  padding:15px;
  border-radius:20px;
  margin:15px 0;
  font-weight:600;
  position:relative;
}

.chat-label{
  position:absolute;
  top:-10px;
  left:15px;
  background:#ff7a00;
  color:white;
  padding:4px 10px;
  border-radius:12px;
  font-size:11px;
  font-weight:700;
}

.clock{
  width:240px;
  height:240px;
  border:6px solid #333;
  border-radius:50%;
  margin:15px auto;
  position:relative;
  background:white;
}

.number{
  position:absolute;
  font-weight:700;
  transform:translate(-50%,-50%);
}

.tick{
  position:absolute;
  width:2px;
  height:10px;
  background:#333;
  top:0;
  left:50%;
  transform-origin:bottom;
}

.hand{
  position:absolute;
  bottom:50%;
  left:50%;
  transform-origin:bottom;
  transform:translateX(-50%) rotate(0deg);
}

.hour{width:6px;height:55px;background:#1f78c8;}
.minute{width:4px;height:80px;background:#f57c00;}

.center-dot{
  width:12px;height:12px;background:black;
  border-radius:50%;
  position:absolute;top:50%;left:50%;
  transform:translate(-50%,-50%);
}

.time-buttons{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:8px;
  margin-top:10px;
}

button{
  padding:10px;
  border:none;
  border-radius:12px;
  background:#1f78c8;
  color:white;
  font-weight:600;
  cursor:pointer;
  transition:0.2s;
}

.selected{
  filter:brightness(0.65);
  transform:scale(0.96);
}

button:active{filter:brightness(0.7);}

.minute-btn{background:#0f479a;}
.submit-btn{background:#ec8633;}

@keyframes shake{
  0%{transform:translateX(0);}
  25%{transform:translateX(-5px);}
  50%{transform:translateX(5px);}
  75%{transform:translateX(-5px);}
  100%{transform:translateX(0);}
}

.lives{margin-top:15px;font-size:22px;}
.heart{display:inline-block;}
.shake-heart{animation:shake 0.4s;}

.footer{
  position:absolute;
  bottom:0;
  width:100%;
  height:80px;
  background:#ff8c3a;
  display:flex;
  justify-content:space-around;
  align-items:center;
  border-top-left-radius:0px;
  border-top-right-radius:0px;
}

.footer a{
  text-decoration:none;
  color:white;
  font-size:12px;
  display:flex;
  flex-direction:column;
  align-items:center;
}

.footer img{width:28px;margin-bottom:4px;}

.popup-overlay{
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  background:rgba(0,0,0,0.5);
  display:flex;
  justify-content:center;
  align-items:center;
  opacity:0;
  pointer-events:none;
  transition:0.3s;
  z-index:999;
}

.popup-overlay.active{
  opacity:1;
  pointer-events:auto;
}

.popup-box{
  background:white;
  padding:25px;
  border-radius:20px;
  text-align:center;
  width:80%;
  max-width:320px;
}

.popup-btn{
  margin-top:10px;
  width:100%;
  background:#ff7a00;
}
</style>
</head>

<body>
<div class="mobile-wrapper">
<div class="content">

<img src="img/minituro.png" class="logo">
<img id="wizard" class="character" src="img/ticktockwizard.gif">

<div class="question">
  <div class="chat-label">Tick Tock Wizard</div>
  <div id="dialogueText"></div>
</div>

<div id="gameArea"></div>

<div class="lives" id="lives"></div>
(lives left)

</div>

<div class="footer">
  <a href="home.html"><img src="img/home.png">Home</a>
  <a href="info.html"><img src="img/info.png">Info</a>
</div>
</div>

<div id="popup" class="popup-overlay">
  <div class="popup-box">
    <h3 id="popupText"></h3>
    <div id="popupButtons"></div>
  </div>
</div>

<script>

const dialogueText = document.getElementById("dialogueText");
const gameArea = document.getElementById("gameArea");
const popup = document.getElementById("popup");
const popupText = document.getElementById("popupText");
const popupButtons = document.getElementById("popupButtons");

let lives = 7;
let current = 0;

// FIX 1: null instead of 0 so minute "0" button works correctly
let selectedHour = null;
let selectedMinute = null;
let selectedPeriod = "";

const timeQuestions = [
  {hour:1, minute:0, period:"AM"},
  {hour:3, minute:30, period:"PM"},
  {hour:6, minute:15, period:"PM"},
  {hour:9, minute:45, period:"AM"},
  {hour:11, minute:30, period:"PM"},
  {hour:8, minute:30, period:"PM"},
  {hour:3, minute:0, period:"AM"}
];

function renderLives(){
  let html="";
  for(let i=0;i<lives;i++){
    html += "<span class='heart'>‚ù§Ô∏è</span>";
  }
  document.getElementById("lives").innerHTML = html;
}
renderLives();

function createClockNumbers(){
  let clock = document.querySelector(".clock");

  for(let i=1;i<=12;i++){
    let angle = i*30;
    let x = 120 + 90*Math.sin(angle*Math.PI/180);
    let y = 120 - 90*Math.cos(angle*Math.PI/180);

    let num = document.createElement("div");
    num.className = "number";
    num.style.left = x+"px";
    num.style.top = y+"px";
    num.innerText = i;
    clock.appendChild(num);
  }

  for(let i=0;i<60;i++){
    let tick = document.createElement("div");
    tick.className = "tick";
    tick.style.transform = `rotate(${i*6}deg)`;
    clock.appendChild(tick);
  }
}

function loadQuestion(){

  // FIX 1: reset to null
  selectedHour = 12;
  selectedMinute = 0;
  selectedPeriod = "AM";

  let q = timeQuestions[current];

  dialogueText.innerText =
    `Set the clock to ${q.hour}:${q.minute.toString().padStart(2,'0')} ${q.period}!`;

  gameArea.innerHTML = `
  <div class="clock">
    <div class="hand hour" id="hourHand"></div>
    <div class="hand minute" id="minuteHand"></div>
    <div class="center-dot"></div>
  </div>

  <!-- FIX 2: each group has its own ID so clearSelected never touches the wrong group -->
  <div class="time-buttons" id="hourBtns">
    ${[1,2,3,4,5,6,7,8,9,10,11,12]
      .map(n=>`<button onclick="setHour(${n},this)">${n}</button>`).join("")}
  </div>

  <div class="time-buttons" id="minuteBtns">
    ${[0,15,30,45]
      .map(n=>`<button class="minute-btn" onclick="setMinute(${n},this)">${n}</button>`).join("")}
  </div>

  <div class="time-buttons" id="periodBtns">
    <button onclick="setPeriod('AM',this)">AM</button>
    <button onclick="setPeriod('PM',this)">PM</button>
  </div>

  <div style="margin-top:20px;">
    <button class="submit-btn" onclick="submitTime()">Cast Spell ‚ú®</button>
  </div>
  `;

  createClockNumbers();
}

function setHour(h, btn){
  if(selectedHour === h){
    selectedHour = null;
    btn.classList.remove("selected");
    document.getElementById("hourHand").style.transform = `translateX(-50%) rotate(0deg)`;
    return;
  }

  selectedHour = h;
  // FIX 2: use #hourBtns instead of :first-of-type
  document.querySelectorAll("#hourBtns button")
    .forEach(b => b.classList.remove("selected"));
  btn.classList.add("selected");
  document.getElementById("hourHand").style.transform = `translateX(-50%) rotate(${h*30}deg)`;
}

function setMinute(m, btn){
  if(selectedMinute === m){
    selectedMinute = null;
    btn.classList.remove("selected");
    document.getElementById("minuteHand").style.transform = `translateX(-50%) rotate(0deg)`;
    return;
  }

  selectedMinute = m;
  // FIX 2: use #minuteBtns instead of .minute-btn (which would also grab other pages if reused)
  document.querySelectorAll("#minuteBtns button")
    .forEach(b => b.classList.remove("selected"));
  btn.classList.add("selected");
  document.getElementById("minuteHand").style.transform = `translateX(-50%) rotate(${m*6}deg)`;
}

function setPeriod(p, btn){
  if(selectedPeriod === p){
    selectedPeriod = "";
    btn.classList.remove("selected");
    return;
  }

  selectedPeriod = p;
  // FIX 2: use #periodBtns instead of nth-of-type(3)
  document.querySelectorAll("#periodBtns button")
    .forEach(b => b.classList.remove("selected"));
  btn.classList.add("selected");
}

function submitTime(){
  let q = timeQuestions[current];

  if(selectedHour === q.hour &&
     selectedMinute === q.minute &&
     selectedPeriod === q.period){

    current++;

    if(current >= timeQuestions.length){
      showWin();
    }else{
      loadQuestion();
    }

  }else{
    loseLife();
  }
}

function loseLife(){
  lives--;
  renderLives();

  document.querySelectorAll(".heart").forEach(h=>{
    h.classList.add("shake-heart");
    setTimeout(()=>h.classList.remove("shake-heart"),400);
  });

  if(lives <= 0){
    showGameOver();
  }
}

function showGameOver(){
  popupText.innerText = "üòµ‚Äçüí´ GAME OVER!";
  popupButtons.innerHTML = `
    <button class="popup-btn" onclick="location.reload()">Restart üîÑ</button>
  `;
  popup.classList.add("active");
}

function showWin(){
  popupText.innerText = "üéâ Boss Defeated! ‚è∞‚ú®";
  popupButtons.innerHTML = `
    <button class="popup-btn" onclick="location.href='home.html'">Back Home üè†</button>
  `;
  popup.classList.add("active");
}

loadQuestion();

</script>
</body>
</html>